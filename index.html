
<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Helpdesk</title>
<link rel="manifest" href="manifest.webmanifest">
<meta name="theme-color" content="#da291c">
<style>
  :root{--sbb:#da291c}
  body{margin:0;font-family:sans-serif;background:#f1f5f9;color:#0f172a}
  header{background:var(--sbb);color:#fff;padding:1rem}
  .wrap{max-width:1000px;margin:0 auto;padding:1rem}
  .grid{display:grid;gap:1rem}
  .section{display:none}.section.active{display:block}
  .btn{padding:.9rem 1rem;border-radius:.7rem;border:0;cursor:pointer;font-size:1rem}
  .btn.danger{background:#dc2626;color:#fff}
  .btn.green{background:#22c55e;color:#fff}
  .cards{display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:.8rem}
  .card{background:#fff;border:1px solid #e2e8f0;border-radius:.8rem;padding:.8rem;text-align:center;box-shadow:0 1px 2px rgba(0,0,0,.1);cursor:pointer}
  .emoji{font-size:2rem;display:block;margin-bottom:.4rem}
  .panel{background:#fff;border:1px solid #cbd5e1;border-radius:.8rem;padding:1rem}
  .panel h3{margin:.2rem 0;border-bottom:2px solid #cbd5e1;padding-bottom:.3rem;display:flex;align-items:center;gap:.4rem}
  .dot{width:.6rem;height:.6rem;background:#1f2937;border-radius:50%;display:inline-block;margin-right:.6rem}
  .link{display:flex;align-items:center;gap:.6rem;padding:.35rem .2rem;border-radius:.4rem;cursor:pointer}
  .link:hover{background:#f1f5f9}
  .two{display:grid;grid-template-columns:1fr;gap:1rem}
  @media(min-width:900px){.two{grid-template-columns:1fr 1fr}}
  .list{display:grid;gap:.6rem}
  .item{background:#fff;border:1px solid #e2e8f0;border-radius:.6rem;padding:.6rem}
</style>
<script>
const HOTLINE_TEL = '051-222-1853';
const FAHRZEUGE = ['Re 450 DPZ','Re 420 HVZ-D','RABe 514 DTZ','RABe 511 RVD'];
const KATEGORIEN = [
  {name:'Bremsen',icon:'🛑'},
  {name:'Fahrsperre',icon:'🚦'},
  {name:'Reset',icon:'🔄'},
  {name:'Leittechnik',icon:'💻'},
  {name:'Pneumatik',icon:'🔧'},
  {name:'Zugbeeinflussung',icon:'📡'},
  {name:'TELOC / V-Messer',icon:'📊'},
  {name:'Schleppen',icon:'🚛'},
  {name:'Einstiegstüren',icon:'🚪'},
  {name:'Kupplung',icon:'🔗'},
  {name:'HLK',icon:'❄️'},
  {name:'KIS / TIMS / Funk',icon:'📢'},
  {name:'WC',icon:'🚻'},
  {name:'Dokumente',icon:'📄'}
];
let DATA=[], state={fahrzeug:null,kategorie:null,unter:null};
async function init(){ if('serviceWorker' in navigator){navigator.serviceWorker.register('./sw.js');} try{DATA=await (await fetch('data.json')).json();}catch(e){DATA=[];} show('s1'); }
function show(id){document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));document.getElementById(id).classList.add('active');window.scrollTo(0,0);}
function urgent(level){ if(level==='high'){document.getElementById('hotline-title').textContent='Bitte rufe den Helpdesk an';document.getElementById('hotline-number').textContent=HOTLINE_TEL;document.getElementById('hotline-link').href='tel:'+HOTLINE_TEL;show('urgent');} else show('s2'); }
function pickFahrzeug(v){state.fahrzeug=v;show('s3');}
function pickKategorie(k){
  state.kategorie=k; state.unter=null;
  if(state.fahrzeug==='Re 450 DPZ' && state.kategorie==='Bremsen'){ show('s3b'); }
  else { renderResults(); show('s4'); }
}
function pickUnter(u){ state.unter=u; renderResults(); show('s4'); }
function renderResults(){
  const list=document.getElementById('results'); list.innerHTML='';
  const arr=DATA.filter(it=>(!state.fahrzeug||it.fahrzeug===state.fahrzeug)&&(!state.kategorie||it.kategorie===state.kategorie)&&(!state.unter||it.unterkategorie===state.unter));
  if(arr.length===0){ list.innerHTML='<div class="item">Keine Treffer.</div>'; return; }
  arr.forEach(it=>{
    const div=document.createElement('div'); div.className='item';
    const sub = it.unterkategorie ? ' · '+it.unterkategorie : '';
    div.innerHTML='<h3>'+it.titel+'</h3><p><strong>'+it.fahrzeug+'</strong> · '+it.kategorie+sub+' · '+(it.schweregrad||'')+'</p>'
      +'<details style="margin-top:.4rem"><summary>Details</summary>'
      +'<h4>Sofortmaßnahmen</h4><ul>'+(it.sofortmassnahmen||[]).map(x=>'<li>'+x+'</li>').join('')+'</ul>'
      +'<h4>Schritte</h4><ol>'+(it.schritte||[]).map(x=>'<li>'+x+'</li>').join('')+'</ol>'
      +'<p><strong>Hinweise:</strong> '+(it.hinweise||'')+'</p>'
      +'</details>';
    list.appendChild(div);
  });
}
document.addEventListener('DOMContentLoaded',init);
</script>
</head>
<body>
<header><h1>Helpdesk</h1></header>
<div class="wrap">

  <!-- Schritt 1: Dringlichkeit -->
  <section class="section active" id="s1">
    <h2>Wie dringend ist die Störungsbehebung?</h2>
    <div class="grid">
      <button class="btn danger" onclick="urgent('high')">Sehr dringend</button>
      <button class="btn green" onclick="urgent('normal')">Nicht dringend</button>
    </div>
  </section>

  <!-- Dringend: Hotline -->
  <section class="section" id="urgent">
    <h2 id="hotline-title">Bitte rufe den Helpdesk an</h2>
    <a id="hotline-link" class="btn danger" href="#"><strong>Anrufen:</strong> <span id="hotline-number"></span></a>
    <button class="btn green" onclick="show('s2')" style="margin-top:.6rem">Weiter</button>
  </section>

  <!-- Schritt 2: Fahrzeug -->
  <section class="section" id="s2">
    <h2>Welches Fahrzeug?</h2>
    <div class="grid">
      <script>document.currentScript.insertAdjacentHTML('beforebegin',FAHRZEUGE.map(v=>'<button class="btn" style="background:#e2e8f0" onclick="pickFahrzeug(\''+v+'\')">'+v+'</button>').join(''))</script>
    </div>
  </section>

  <!-- Schritt 3: Kategorie -->
  <section class="section" id="s3">
    <h2>Kategorie wählen</h2>
    <div class="cards">
      <script>document.currentScript.parentElement.innerHTML=KATEGORIEN.map(k=>'<div class="card" onclick="pickKategorie(\''+k.name+'\')"><span class="emoji">'+k.icon+'</span>'+k.name+'</div>').join('');</script>
    </div>
    <button class="btn" style="background:#e2e8f0" onclick="show('s2')" >Zurück</button>
  </section>

  <!-- Schritt 3b: Untermenü (2 Spalten) nur für Re 450 DPZ + Bremsen -->
  <section class="section" id="s3b">
    <h2>Bremsen · Re 450 DPZ</h2>
    <div class="two">
      <div class="panel">
        <h3>📘 Federspeicherbremse</h3>
        <div class="link" onclick="pickUnter('Federspeicherbremse')"><span class="dot"></span><span>Störung Federspeicherbremse</span></div>
        <div class="link" onclick="pickUnter('Federspeicherbremse')"><span class="dot"></span><span>Federspeicherbremse Notlösen AB/Bt</span></div>
        <div class="link" onclick="pickUnter('Federspeicherbremse')"><span class="dot"></span><span>Federspeicherbremse reaktivieren AB/Bt</span></div>
        <div class="link" onclick="pickUnter('Federspeicherbremse')"><span class="dot"></span><span>Federspeicherbremse Notlösen NDW</span></div>
        <div class="link" onclick="pickUnter('Federspeicherbremse')"><span class="dot"></span><span>Federspeicherbremse reaktivieren NDW</span></div>
      </div>
      <div class="panel">
        <h3>📘 Pneumatische Bremse</h3>
        <div class="link" onclick="pickUnter('Pneumatische Bremse')"><span class="dot"></span><span>Bremsen Auszupfen</span></div>
        <div class="link" onclick="pickUnter('Pneumatische Bremse')"><span class="dot"></span><span>Gesamte Bremse ausschalten AB/Bt</span></div>
        <div class="link" onclick="pickUnter('Pneumatische Bremse')"><span class="dot"></span><span>Gesamte Bremse ausschalten NDW</span></div>
        <div class="link" onclick="pickUnter('Pneumatische Bremse')"><span class="dot"></span><span>Automatische Bremse ausschalten AB/Bt</span></div>
        <div class="link" onclick="pickUnter('Pneumatische Bremse')"><span class="dot"></span><span>Automatische Bremse ausschalten NDW</span></div>
        <div class="link" onclick="pickUnter('Pneumatische Bremse')"><span class="dot"></span><span>EP‑Bremse an AB/Bt ausschalten</span></div>
      </div>
    </div>
    <button class="btn" style="background:#e2e8f0;margin-top:1rem" onclick="show('s3')">Zurück</button>
  </section>

  <!-- Schritt 4: Ergebnisse -->
  <section class="section" id="s4">
    <h2>Ergebnisse</h2>
    <div id="results" class="list"></div>
    <button class="btn" style="background:#e2e8f0;margin-top:.6rem" onclick="show('s3')">Zurück</button>
  </section>

</div>
<footer style="text-align:center;color:#475569;padding:2rem">Helpdesk · Feedback: <a href="mailto:pascal.ammann@sbb.ch">pascal.ammann@sbb.ch</a></footer>
</body>
</html>
