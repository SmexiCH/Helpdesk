
<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>WikiSt√∂ria</title>
<link rel="manifest" href="manifest.webmanifest">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<meta name="theme-color" content="#da291c">
<style>
  :root{
    /* Light theme (default) */
    --bg1:#f9fafb; --bg2:#e5e7eb;
    --text:#111827; --muted:#6b7280;
    --card:#ffffff; --border:#e5e7eb;
    --primary:#da291c; --danger:#ef4444; --success:#22c55e;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:'Inter',system-ui,Arial,sans-serif;color:var(--text);
       background: linear-gradient(135deg,var(--bg1),var(--bg2));}
  header{position:sticky;top:0;z-index:10;background:var(--primary);color:#fff;
         padding:1rem 1.25rem;box-shadow:0 4px 16px rgba(0,0,0,.15)}
  header h1{margin:0;font-size:1.4rem;letter-spacing:.2px}
  .wrap{max-width:1100px;margin:0 auto;padding:1.25rem}
  .section{display:none}.section.active{display:block}
  .cardrow{display:grid;grid-template-columns:1fr;gap:1rem}
  @media(min-width:700px){.cardrow{grid-template-columns:repeat(2,1fr)}}
  .card{background:var(--card);border:1px solid var(--border);border-radius:1rem;padding:1.25rem;
        box-shadow:0 6px 18px rgba(0,0,0,.06);display:flex;align-items:center;gap:.9rem;cursor:pointer;
        transition:transform .15s ease, box-shadow .15s ease}
  .card:hover{transform:translateY(-3px);box-shadow:0 10px 24px rgba(0,0,0,.1)}
  .card .icon{font-size:1.6rem}
  .card .title{font-weight:700}
  .btn{padding:.85rem 1rem;border-radius:.7rem;border:0;cursor:pointer;font-weight:600}
  .btn.danger{background:var(--danger);color:white}
  .btn.success{background:var(--success);color:white}
  .grid{display:grid;gap:1rem}
  .cards{display:grid;grid-template-columns:repeat(auto-fill,minmax(130px,1fr));gap:1rem}
  .cat{background:var(--card);border:1px solid var(--border);border-radius:1rem;padding:1rem;text-align:center;
       box-shadow:0 6px 18px rgba(0,0,0,.06);cursor:pointer}
  .emoji{font-size:2rem;display:block;margin-bottom:.4rem}
  .panel{background:var(--card);border:1px solid var(--border);border-radius:1rem;padding:1rem;box-shadow:0 6px 18px rgba(0,0,0,.06)}
  .two{display:grid;grid-template-columns:1fr;gap:1rem}
  @media(min-width:900px){.two{grid-template-columns:1fr 1fr}}
  .link{display:flex;align-items:center;gap:.6rem;padding:.45rem;border-radius:.5rem;cursor:pointer}
  .link:hover{background:#f3f4f6}
  .dot{width:.55rem;height:.55rem;background:#1f2937;border-radius:50%}
  .list{display:grid;gap:1rem}
  .item{background:var(--card);border:1px solid var(--border);border-radius:1rem;padding:1rem;box-shadow:0 6px 18px rgba(0,0,0,.06)}
  h2{margin:.2rem 0 1rem}
  footer{color:var(--muted);text-align:center;padding:2rem 1rem}

  /* Dark theme */
  body[data-theme="dark"]{
    --bg1:#0f172a; --bg2:#020617;
    --text:#e5e7eb; --muted:#94a3b8;
    --card:#111827; --border:#1f2937;
    --primary:#da291c; --danger:#ef4444; --success:#22c55e;
  }
  body[data-theme="dark"] header{ background: var(--primary); color:#fff; }
  body[data-theme="dark"] .card:hover{ box-shadow:0 10px 24px rgba(0,0,0,.35) }
  body[data-theme="dark"] .link:hover{ background:#0b1220 }
  body[data-theme="dark"] footer{ color:#94a3b8 }
</style>

<script>
const HOTLINE_TEL = '051-222-1853';
const FAHRZEUGE = ['Re 450 DPZ','Re 420 HVZ-D','RABe 514 DTZ','RABe 511 RVD'];
const KATEGORIEN = [
  {name:'Bremsen',icon:'üõë'},
  {name:'Fahrsperre',icon:'üö¶'},
  {name:'Reset',icon:'üîÑ'},
  {name:'Leittechnik',icon:'üíª'},
  {name:'Pneumatik',icon:'üîß'},
  {name:'Zugbeeinflussung',icon:'üì°'},
  {name:'TELOC / V-Messer',icon:'üìä'},
  {name:'Schleppen',icon:'üöõ'},
  {name:'Einstiegst√ºren',icon:'üö™'},
  {name:'Kupplung',icon:'üîó'},
  {name:'HLK',icon:'‚ùÑÔ∏è'},
  {name:'KIS / TIMS / Funk',icon:'üì¢'},
  {name:'WC',icon:'üöª'},
  {name:'Dokumente',icon:'üìÑ'}
];
let DATA=[], state={fahrzeug:null,kategorie:null,unterId:null};
async function init(){ if('serviceWorker' in navigator){navigator.serviceWorker.register('./sw.js');} try{DATA=await (await fetch('data.json')).json();}catch(e){DATA=[];} show('s1'); }
function show(id){document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));document.getElementById(id).classList.add('active');window.scrollTo(0,0);}
function urgent(level){ if(level==='high'){document.getElementById('hotline-title').textContent='Bitte rufe den Helpdesk an';document.getElementById('hotline-number').textContent=HOTLINE_TEL;document.getElementById('hotline-link').href='tel:'+HOTLINE_TEL;show('urgent');} else show('s2'); }
function pickFahrzeug(v){state.fahrzeug=v;show('s3');}
function pickKategorie(k){
  state.kategorie=k; state.unterId=null;
  if(state.fahrzeug==='Re 450 DPZ' && state.kategorie==='Bremsen'){ show('s3b'); }
  else { renderResults(); show('s4'); }
}
function pickUnter(id){ state.unterId=id; renderResults(); show('s4'); }
function renderResults(){
  const list=document.getElementById('results'); list.innerHTML='';
  let arr;
  if(state.unterId){ arr = DATA.filter(it => it.id === state.unterId); }
  else { arr = DATA.filter(it => (!state.fahrzeug || it.fahrzeug===state.fahrzeug) && (!state.kategorie || it.kategorie===state.kategorie)); }
  if(arr.length===0){ list.innerHTML='<div class="item">Keine Treffer.</div>'; return; }
  arr.forEach(it=>{
    const div=document.createElement('div'); div.className='item';
    const sub = it.unterkategorie ? ' ¬∑ '+it.unterkategorie : '';
    div.innerHTML='<h3 style="margin:.2rem 0 0">'+it.titel+'</h3>'
      +'<p style="margin:.3rem 0 .6rem;color:#374151"><strong>'+it.fahrzeug+'</strong> ¬∑ '+it.kategorie+sub+' ¬∑ '+(it.schweregrad||'')+'</p>'
      +'<h4>Sofortma√ünahmen</h4><ul>'+(it.sofortmassnahmen||[]).map(x=>'<li>'+x+'</li>').join('')+'</ul>'
      +'<h4>Schritte</h4><ol>'+(it.schritte||[]).map(x=>'<li>'+x+'</li>').join('')+'</ol>'
      +'<p><strong>Hinweise:</strong> '+(it.hinweise||'')+'</p>';
    list.appendChild(div);
  });
}
document.addEventListener('DOMContentLoaded',init);
</script>
<script>
(function(){
  const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
  const saved = localStorage.getItem('wikistoeria_theme');
  const current = saved || (prefersDark ? 'dark' : 'light');
  document.body.setAttribute('data-theme', current);
  const btn = document.getElementById('themeToggle');
  function toggle(){
    const now = document.body.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
    document.body.setAttribute('data-theme', now);
    localStorage.setItem('wikistoeria_theme', now);
  }
  if(btn){ btn.addEventListener('click', toggle); }
})();</script>
</head>
<body>
<header>
  <div style="display:flex;align-items:center;gap:1rem;justify-content:space-between;max-width:1100px;margin:0 auto">
    <h1>WikiSt√∂ria</h1>
    <button id="themeToggle" aria-label="Darstellung umschalten" title="Darstellung umschalten"
      style="background:rgba(255,255,255,.15);color:#fff;border:1px solid rgba(0,0,0,.2);padding:.5rem .75rem;border-radius:.6rem;cursor:pointer">
      üåô / ‚òÄÔ∏è
    </button>
  </div>
</header>
<div class="wrap">

  <!-- Schritt 1: Moderne Startseite mit Cards -->
  <section class="section active" id="s1">
    <h2>Wie dringend ist die St√∂rungsbehebung?</h2>
    <div class="cardrow">
      <div class="card" onclick="urgent('high')">
        <div class="icon">‚è±Ô∏è</div>
        <div>
          <div class="title">Sehr dringend</div>
          <div style="color:var(--muted)">Stillstand / baldige Abfahrt n√∂tig</div>
        </div>
        <div style="margin-left:auto"><button class="btn danger">Weiter</button></div>
      </div>
      <div class="card" onclick="urgent('normal')">
        <div class="icon">‚úÖ</div>
        <div>
          <div class="title">Nicht dringend</div>
          <div style="color:var(--muted)">Leite zur Auswahl weiter</div>
        </div>
        <div style="margin-left:auto"><button class="btn success">Weiter</button></div>
      </div>
    </div>
  </section>

  <!-- Dringend: Hotline -->
  <section class="section" id="urgent">
    <h2 id="hotline-title">Bitte rufe den Helpdesk an</h2>
    <a id="hotline-link" class="btn danger" href="#"><strong>Anrufen:</strong> <span id="hotline-number"></span></a>
    <div style="height:.6rem"></div>
    <button class="btn success" onclick="show('s2')">Weiter</button>
  </section>

  <!-- Schritt 2: Fahrzeug -->
  <section class="section" id="s2">
    <h2>Welches Fahrzeug?</h2>
    <div class="grid">
      <script>
        document.currentScript.insertAdjacentHTML('beforebegin',
          FAHRZEUGE.map(v=>'<div class="card" onclick="pickFahrzeug(\''+v+'\')"><div class="icon">üöÜ</div><div class="title">'+v+'</div></div>').join('')
        )
      </script>
    </div>
  </section>

  <!-- Schritt 3: Kategorie -->
  <section class="section" id="s3">
    <h2>Kategorie w√§hlen</h2>
    <div class="cards">
      <script>
        document.currentScript.parentElement.innerHTML=KATEGORIEN.map(k=>'<div class="cat" onclick="pickKategorie(\''+k.name+'\')"><span class="emoji">'+k.icon+'</span>'+k.name+'</div>').join('');
      </script>
    </div>
    <div style="margin-top:1rem"><button class="btn" onclick="show('s2')">Zur√ºck</button></div>
  </section>

  <!-- Schritt 3b: Untermen√º -->
  <section class="section" id="s3b">
    <h2>Bremsen ¬∑ Re 450 DPZ</h2>
    <div class="two">
      <div class="panel">
        <h3>üìò Federspeicherbremse</h3>
        <div class="link" onclick="pickUnter('fsb_stoerung')"><span class="dot"></span><span>St√∂rung Federspeicherbremse</span></div>
        <div class="link" onclick="pickUnter('fsb_notloesen_ab_bt')"><span class="dot"></span><span>Federspeicherbremse Notl√∂sen AB/Bt</span></div>
        <div class="link" onclick="pickUnter('fsb_reaktiv_ab_bt')"><span class="dot"></span><span>Federspeicherbremse reaktivieren AB/Bt</span></div>
        <div class="link" onclick="pickUnter('fsb_notloesen_ndw')"><span class="dot"></span><span>Federspeicherbremse Notl√∂sen NDW</span></div>
        <div class="link" onclick="pickUnter('fsb_reaktiv_ndw')"><span class="dot"></span><span>Federspeicherbremse reaktivieren NDW</span></div>
      </div>
      <div class="panel">
        <h3>üìò Pneumatische Bremse</h3>
        <div class="link" onclick="pickUnter('pb_auszupfen')"><span class="dot"></span><span>Bremsen Auszupfen</span></div>
        <div class="link" onclick="pickUnter('pb_ges_ab_bt')"><span class="dot"></span><span>Gesamte Bremse ausschalten AB/Bt</span></div>
        <div class="link" onclick="pickUnter('pb_ges_ndw')"><span class="dot"></span><span>Gesamte Bremse ausschalten NDW</span></div>
        <div class="link" onclick="pickUnter('pb_auto_ab_bt')"><span class="dot"></span><span>Automatische Bremse ausschalten AB/Bt</span></div>
        <div class="link" onclick="pickUnter('pb_auto_ndw')"><span class="dot"></span><span>Automatische Bremse ausschalten NDW</span></div>
        <div class="link" onclick="pickUnter('pb_ep_ab_bt')"><span class="dot"></span><span>EP‚ÄëBremse an AB/Bt ausschalten</span></div>
      </div>
    </div>
    <div style="margin-top:1rem"><button class="btn" onclick="show('s3')">Zur√ºck</button></div>
  </section>

  <!-- Schritt 4: Ergebnisse -->
  <section class="section" id="s4">
    <h2>Ergebnisse</h2>
    <div id="results" class="list"></div>
    <div style="margin-top:1rem"><button class="btn" onclick="show('s3')">Zur√ºck</button></div>
  </section>

</div>
<footer>WikiSt√∂ria ¬∑ Feedback: <a href="mailto:pascal.ammann@sbb.ch">pascal.ammann@sbb.ch</a></footer>
</body>
</html>
