
<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>WikiSt√∂ria</title>
<link rel="manifest" href="manifest.webmanifest">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<meta name="theme-color" content="#da291c">
<style>
  :root{
    --bg1:#0b1220; --bg2:#111827;
    --card:rgba(255,255,255,0.08); --cardBorder:rgba(255,255,255,0.18);
    --text:#e5e7eb; --muted:#94a3b8;
    --primary:#da291c; --danger:#ef4444; --success:#22c55e;
    --shadow: 0 10px 30px rgba(0,0,0,.35);
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:'Inter',system-ui,Arial,sans-serif;color:var(--text);
       background: radial-gradient(1200px 700px at 20% -10%, #1e3a8a 0%, transparent 60%),
                   radial-gradient(1000px 600px at 100% 0%, #881337 0%, transparent 55%),
                   linear-gradient(135deg,var(--bg1),var(--bg2));
       min-height:100vh;}
  /* Header with Glass Bar */
  header{position:sticky;top:0;z-index:20;backdrop-filter:saturate(180%) blur(10px);
         background: rgba(13,18,31,0.6); border-bottom:1px solid rgba(255,255,255,.07);}
  .topbar{display:flex;align-items:center;justify-content:space-between;gap:1rem;max-width:1100px;margin:0 auto;padding:1rem 1.25rem}
  .brand{display:flex;align-items:center;gap:.75rem;font-weight:700;letter-spacing:.2px}
  .brand .logo{width:28px;height:28px;border-radius:8px;background:#da291c;display:inline-grid;place-items:center;color:#fff;font-weight:800;box-shadow:var(--shadow)}
  #themeToggle{background:rgba(255,255,255,.12);color:#fff;border:1px solid rgba(255,255,255,.25);padding:.5rem .75rem;border-radius:.6rem;cursor:pointer}
  .wrap{max-width:1100px;margin:0 auto;padding:1.25rem}
  .hero{margin:1rem 0 1.25rem;display:grid;gap:1rem}
  .hero .title{font-size:1.9rem;font-weight:800;letter-spacing:.3px}
  .hero .subtitle{color:var(--muted)}
  /* Glass cards */
  .glass{background:var(--card); border:1px solid var(--cardBorder); border-radius:1rem; box-shadow:var(--shadow); backdrop-filter: blur(12px) saturate(140%);}
  .cardrow{display:grid;grid-template-columns:1fr;gap:1rem}
  @media(min-width:760px){.cardrow{grid-template-columns:repeat(2,1fr)}}
  .card{padding:1.25rem; display:flex; align-items:center; gap:.9rem; cursor:pointer; transition:transform .15s ease, box-shadow .15s ease;}
  .card:hover{transform:translateY(-3px)}
  .card .icon{font-size:1.6rem}
  .card .title{font-weight:700}
  .btn{padding:.85rem 1rem;border-radius:.7rem;border:0;cursor:pointer;font-weight:700}
  .btn.danger{background:var(--danger);color:white}
  .btn.success{background:var(--success);color:white}
  /* Categories */
  .cards{display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:1rem}
  .cat{padding:1rem;text-align:center}
  .emoji{font-size:2rem;display:block;margin-bottom:.4rem}
  /* Panels */
  .panel{padding:1rem}
  .two{display:grid;grid-template-columns:1fr;gap:1rem}
  @media(min-width:900px){.two{grid-template-columns:1fr 1fr}}
  .link{display:flex;align-items:center;gap:.6rem;padding:.45rem;border-radius:.5rem;cursor:pointer}
  .link:hover{background:rgba(255,255,255,.06)}
  .dot{width:.55rem;height:.55rem;background:#cbd5e1;border-radius:50%}
  /* Results */
  .list{display:grid;gap:1rem}
  .item{padding:1rem}
  h2{margin:.2rem 0 1rem}
  footer{color:var(--muted);text-align:center;padding:2rem 1rem}
  a{color:#93c5fd}
  /* Light theme variant via data attribute */
  body[data-theme="light"]{
    --bg1:#f9fafb; --bg2:#e5e7eb;
    --text:#111827; --muted:#475569;
    --card:rgba(255,255,255,0.7); --cardBorder:rgba(255,255,255,0.8);
  }
  body[data-theme="light"] .link:hover{background:rgba(0,0,0,.05)}
</style>
<script>
const HOTLINE_TEL = '051-222-1853';
const FAHRZEUGE = ['Re 450 DPZ','Re 420 HVZ-D','RABe 514 DTZ','RABe 511 RVD'];
const KATEGORIEN = [
  {name:'Bremsen',icon:'üõë'},
  {name:'Fahrsperre',icon:'üö¶'},
  {name:'Reset',icon:'üîÑ'},
  {name:'Leittechnik',icon:'üíª'},
  {name:'Pneumatik',icon:'üîß'},
  {name:'Zugbeeinflussung',icon:'üì°'},
  {name:'TELOC / V-Messer',icon:'üìä'},
  {name:'Schleppen',icon:'üöõ'},
  {name:'Einstiegst√ºren',icon:'üö™'},
  {name:'Kupplung',icon:'üîó'},
  {name:'HLK',icon:'‚ùÑÔ∏è'},
  {name:'KIS / TIMS / Funk',icon:'üì¢'},
  {name:'WC',icon:'üöª'},
  {name:'Dokumente',icon:'üìÑ'}
];
let DATA=[], state={fahrzeug:null,kategorie:null,unterId:null};
async function init(){ if('serviceWorker' in navigator){navigator.serviceWorker.register('./sw.js');} try{DATA=await (await fetch('data.json')).json();}catch(e){DATA=[];} show('s1'); }
function show(id){document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));document.getElementById(id).classList.add('active');window.scrollTo(0,0);}
function urgent(level){ if(level==='high'){document.getElementById('hotline-title').textContent='Bitte rufe den Helpdesk an';document.getElementById('hotline-number').textContent=HOTLINE_TEL;document.getElementById('hotline-link').href='tel:'+HOTLINE_TEL;show('urgent');} else show('s2'); }
function pickFahrzeug(v){state.fahrzeug=v;show('s3');}
function pickKategorie(k){
  state.kategorie=k; state.unterId=null;
  if(state.fahrzeug==='Re 450 DPZ' && state.kategorie==='Bremsen'){ show('s3b'); }
  else if(state.fahrzeug==='Re 450 DPZ' && state.kategorie==='Reset'){ show('s3c'); }
  else { renderResults(); show('s4'); }
}
function pickUnter(id){ state.unterId=id; renderResults(); show('s4'); }
function renderResults(){
  const list=document.getElementById('results'); list.innerHTML='';
  let arr;
  if(state.unterId){ arr = DATA.filter(it => it.id === state.unterId); }
  else { arr = DATA.filter(it => (!state.fahrzeug || it.fahrzeug===state.fahrzeug) && (!state.kategorie || it.kategorie===state.kategorie)); }
  if(arr.length===0){ list.innerHTML='<div class="glass item">Keine Treffer.</div>'; return; }
  arr.forEach(it=>{
    const div=document.createElement('div'); div.className='glass item';
    const sub = it.unterkategorie ? ' ¬∑ '+it.unterkategorie : '';
    // Lightbox-ready: make images inside Hinweise clickable
    const hint = (it.hinweise||'').replaceAll('<img ','<img class="lb" ');
    div.innerHTML='<h3 style="margin:.2rem 0 0">'+it.titel+'</h3>'
      +'<p style="margin:.3rem 0 .6rem;color:#cbd5e1"><strong>'+it.fahrzeug+'</strong> ¬∑ '+it.kategorie+sub+' ¬∑ '+(it.schweregrad||'')+'</p>'
      +'<h4>Sofortma√ünahmen</h4><ul>'+(it.sofortmassnahmen||[]).map(x=>'<li>'+x+'</li>').join('')+'</ul>'
      +'<h4>Schritte</h4><ol>'+(it.schritte||[]).map(x=>'<li>'+x+'</li>').join('')+'</ol>'
      +'<p><strong>Hinweise:</strong> '+ hint +'</p>';
    list.appendChild(div);
  });
  // Bind lightbox
  document.querySelectorAll('.lb').forEach(img=>{
    img.style.maxWidth='100%'; img.style.height='auto'; img.style.cursor='zoom-in';
    img.addEventListener('click',()=>openLightbox(img.src));
  });
}
// Simple lightbox
function openLightbox(src){
  let overlay=document.createElement('div');
  overlay.style.position='fixed';overlay.style.inset='0';overlay.style.background='rgba(0,0,0,.8)';
  overlay.style.display='grid';overlay.style.placeItems='center';overlay.style.zIndex='9999';
  overlay.innerHTML='<img src="'+src+'" style="max-width:92vw;max-height:92vh;border-radius:12px;box-shadow:0 10px 35px rgba(0,0,0,.6)">';
  overlay.addEventListener('click',()=>document.body.removeChild(overlay));
  document.body.appendChild(overlay);
}
document.addEventListener('DOMContentLoaded',function(){
  // Theme init & toggle
  const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
  const saved = localStorage.getItem('wikistoeria_theme');
  const current = saved || (prefersDark ? 'dark' : 'light');
  document.body.setAttribute('data-theme', current);
  const btn = document.getElementById('themeToggle');
  if(btn && !btn.dataset.bound){
    btn.addEventListener('click', function(){
      const now = document.body.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
      document.body.setAttribute('data-theme', now);
      localStorage.setItem('wikistoeria_theme', now);
    });
    btn.dataset.bound = '1';
  }
  init();
});
</script>
</head>
<body>
<header>
  <div class="topbar">
    <div class="brand"><span class="logo">WS</span> WikiSt√∂ria</div>
    <button id="themeToggle" aria-label="Darstellung umschalten" title="Darstellung umschalten">üåô / ‚òÄÔ∏è</button>
  </div>
</header>
<div class="wrap">

  <!-- Schritt 1: Dringlichkeit --> Dringlichkeit -->
  <section class="section" id="s1">
    <!-- Hero (moved inside s1) -->
    
    <div class="glass" style="padding:1.25rem">
      <div class="title">St√∂rungen schnell & sicher beheben</div>
      <div class="subtitle">W√§hle die Dringlichkeit ‚Äì dann Fahrzeug, Kategorie und Unterpunkt. Alles offline verf√ºgbar, mit Bildern & Checklisten.</div>
    </div>
  
    <h2>Wie dringend ist die St√∂rungsbehebung?</h2>
    <div class="cardrow">
      <div class="glass card" onclick="urgent('high')">
        <div class="icon">‚è±Ô∏è</div>
        <div>
          <div class="title">Sehr dringend</div>
          <div style="color:var(--muted)">Stillstand / baldige Abfahrt n√∂tig</div>
        </div>
        <div style="margin-left:auto"><button class="btn danger">Weiter</button></div>
      </div>
      <div class="glass card" onclick="urgent('normal')">
        <div class="icon">‚úÖ</div>
        <div>
          <div class="title">Nicht dringend</div>
          <div style="color:var(--muted)">Leite zur Auswahl weiter</div>
        </div>
        <div style="margin-left:auto"><button class="btn success">Weiter</button></div>
      </div>
    </div>
  

  <!-- Dringend: Hotline -->
  <section class="section active" id="urgent">
    <h2 id="hotline-title">Bitte rufe den Helpdesk an</h2>
    <a id="hotline-link" class="btn danger" href="#"><strong>Anrufen:</strong> <span id="hotline-number"></span></a>
    <div style="height:.6rem"></div>
    <button class="btn success" onclick="show('s2')">Weiter</button>
  

  <!-- Schritt 2: Fahrzeug -->
  <section class="section" id="s2">
    <h2>Welches Fahrzeug?</h2>
    <div class="cards">
      <script>
        document.currentScript.insertAdjacentHTML('beforebegin',
          FAHRZEUGE.map(v=>'<div class="glass cat" onclick="pickFahrzeug(\''+v+'\')"><div class="emoji">üöÜ</div><div class="title">'+v+'</div></div>').join('')
        )
      </script>
    </div>
  

  <!-- Schritt 3: Kategorie -->
  <section class="section" id="s3">
    <h2>Kategorie w√§hlen</h2>
    <div class="cards">
      <script>
        document.currentScript.parentElement.innerHTML=KATEGORIEN.map(k=>'<div class="glass cat" onclick="pickKategorie(\''+k.name+'\')"><span class="emoji">'+k.icon+'</span>'+k.name+'</div>').join('');
      </script>
    </div>
    <div style="margin-top:1rem"><button class="btn" onclick="show('s2')">Zur√ºck</button></div>
  

  <!-- Schritt 3b: Untermen√º Bremsen -->
  <section class="section" id="s3b">
    <h2>Bremsen ¬∑ Re 450 DPZ</h2>
    <div class="two">
      <div class="glass panel">
        <h3>üìò Federspeicherbremse</h3>
        <div class="link" onclick="pickUnter('fsb_stoerung')"><span class="dot"></span><span>St√∂rung Federspeicherbremse</span></div>
        <div class="link" onclick="pickUnter('fsb_notloesen_ab_bt')"><span class="dot"></span><span>Federspeicherbremse Notl√∂sen AB/Bt</span></div>
        <div class="link" onclick="pickUnter('fsb_reaktiv_ab_bt')"><span class="dot"></span><span>Federspeicherbremse reaktivieren AB/Bt</span></div>
        <div class="link" onclick="pickUnter('fsb_notloesen_ndw')"><span class="dot"></span><span>Federspeicherbremse Notl√∂sen NDW</span></div>
        <div class="link" onclick="pickUnter('fsb_reaktiv_ndw')"><span class="dot"></span><span>Federspeicherbremse reaktivieren NDW</span></div>
      </div>
      <div class="glass panel">
        <h3>üìò Pneumatische Bremse</h3>
        <div class="link" onclick="pickUnter('pb_auszupfen')"><span class="dot"></span><span>Bremsen Auszupfen</span></div>
        <div class="link" onclick="pickUnter('pb_ges_ab_bt')"><span class="dot"></span><span>Gesamte Bremse ausschalten AB/Bt</span></div>
        <div class="link" onclick="pickUnter('pb_ges_ndw')"><span class="dot"></span><span>Gesamte Bremse ausschalten NDW</span></div>
        <div class="link" onclick="pickUnter('pb_auto_ab_bt')"><span class="dot"></span><span>Automatische Bremse ausschalten AB/Bt</span></div>
        <div class="link" onclick="pickUnter('pb_auto_ndw')"><span class="dot"></span><span>Automatische Bremse ausschalten NDW</span></div>
        <div class="link" onclick="pickUnter('pb_ep_ab_bt')"><span class="dot"></span><span>EP‚ÄëBremse an AB/Bt ausschalten</span></div>
      </div>
    </div>
    <div style="margin-top:1rem"><button class="btn" onclick="show('s3')">Zur√ºck</button></div>
  

  <!-- Schritt 3c: Untermen√º Reset -->
  <section class="section" id="s3c">
    <h2>Reset ¬∑ Re 450 DPZ</h2>
    <div class="glass panel">
      <h3>üìò Fahrzeug Reset</h3>
      <div class="link" onclick="pickUnter('reset_motor')"><span class="dot"></span><span>Abtrennung von Motordrehgestellen</span></div>
      <div class="link" onclick="pickUnter('reset_leittechnik')"><span class="dot"></span><span>Leittechnik Reset</span></div>
      <div class="link" onclick="pickUnter('reset_funk')"><span class="dot"></span><span>Funk Reset</span></div>
    </div>
    <div style="margin-top:1rem"><button class="btn" onclick="show('s3')">Zur√ºck</button></div>
  

  <!-- Schritt 4: Ergebnisse -->
  <section class="section" id="s4">
    <h2>Ergebnisse</h2>
    <div id="results" class="list"></div>
    <div style="margin-top:1rem"><button class="btn" onclick="show('s3')">Zur√ºck</button></div>
  

</div>
<footer>WikiSt√∂ria ¬∑ Feedback: <a href="mailto:pascal.ammann@sbb.ch">pascal.ammann@sbb.ch</a></footer>
</body>
</html>
